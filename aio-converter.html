<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Toolkit</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Document Converter Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.min.js"></script>
    <!-- HTML to PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        input[type="file"]::file-selector-button {
            @apply bg-indigo-50 text-indigo-700 font-semibold border-0 mr-4 px-4 py-2 rounded-md cursor-pointer hover:bg-indigo-100 transition-colors duration-200;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .input-container { display: none; }
        .input-container.active { display: block; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px;
            background: #4f46e5; border-radius: 50%;
            cursor: pointer;
        }
        input[type=range]::-moz-range-thumb {
            width: 20px; height: 20px;
            background: #4f46e5; border-radius: 50%;
            cursor: pointer;
        }
        
        /* --- Magic Wand Animations --- */
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(-10deg); }
            50% { transform: scale(1.2) rotate(10deg); }
        }
        .animate-sparkle {
            animation: sparkle 1.5s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 2px rgba(253, 224, 71, 0.7)); }
            50% { filter: drop-shadow(0 0 8px rgba(253, 224, 71, 1)); }
        }
        .animate-glow {
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes magic-dust {
            0% { transform: translate(0, 0) scale(0); opacity: 1; }
            100% { transform: translate(var(--x, 0), var(--y, 0)) scale(1); opacity: 0; }
        }
        .sparkle-dust {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: #fde047; /* yellow-300 */
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            animation: magic-dust 1.2s ease-out infinite;
        }

        /* --- Sidebar Popup Animation --- */
        @keyframes popup-intro {
            0% { transform: translateX(10px) scale(0.9); opacity: 0; }
            70% { transform: translateX(-5px) scale(1.05); opacity: 1; }
            100% { transform: translateX(0) scale(1); opacity: 1; }
        }
        .popup-hidden {
            display: none;
            opacity: 0;
        }
        .animate-popup-intro {
            display: block;
            animation: popup-intro 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen py-10">
    <div class="container mx-auto p-4 max-w-5xl w-full">
        <!-- Main application card -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="p-6 md:p-8">
                <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">All-in-One Toolkit</h1>
                <p class="text-center text-gray-500 mb-8">Encode, Decode, Convert Documents & Images, Minify, and Analyze.</p>

                <!-- Tab navigation -->
                <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-2 mb-8 bg-gray-100 p-1 rounded-lg">
                    <button class="tab-btn active text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="encode">Base64 Encode</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="decode">Base64 Decode</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="image-converter">Image Converter</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="image-minifier">Image Minifier</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="doc-converter">Doc Converter</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="html-to-pdf">HTML to PDF</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="unit-converter">Unit Converter</button>
                    <button class="tab-btn text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-200" data-tab="currency-converter">Currency</button>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="p-6 md:p-8 pt-0">
                <!-- Encode Tab -->
                <div id="encode" class="tab-content active space-y-6">
                    <h2 class="font-bold text-lg text-gray-700">Encode to Base64</h2>
                    <div>
                        <label for="encode-type" class="block text-sm font-medium text-gray-700 mb-2">Choose Input Type</label>
                        <select id="encode-type" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 transition shadow-sm">
                            <option value="text">Text / ASCII</option>
                            <option value="hex">Hexadecimal</option>
                            <option value="image">Image (JPG, PNG, GIF, BMP, ICO, SVG, WebP)</option>
                            <option value="pdf">PDF File</option>
                            <option value="audio">Audio (MP3, WAV, OGG, FLAC, WMA)</option>
                            <option value="video">Video File</option>
                            <option value="file">Generic File</option>
                        </select>
                    </div>
                    <!-- Encoder Inputs -->
                    <div id="encode-text-input" class="input-container active">
                        <label for="encode-text-value" class="block text-sm font-medium text-gray-700 mb-2">Text to Encode</label>
                        <textarea id="encode-text-value" rows="5" class="w-full p-3 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                    <div id="encode-hex-input" class="input-container">
                        <label for="encode-hex-value" class="block text-sm font-medium text-gray-700 mb-2">Hex to Encode</label>
                        <textarea id="encode-hex-value" rows="5" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" placeholder="e.g., 48656c6c6f20576f726c64"></textarea>
                    </div>
                    <div id="encode-file-input" class="input-container">
                        <label for="encode-file-value" class="block text-sm font-medium text-gray-700 mb-2">File to Encode</label>
                        <input type="file" id="encode-file-value" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="flex items-center">
                        <input id="encode-url-safe" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="encode-url-safe" class="ml-2 block text-sm text-gray-900">
                            Use Base64URL format (URL and Filename safe)
                        </label>
                    </div>
                    <button id="encode-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition shadow-md">Encode</button>
                    <!-- Encoder Output -->
                    <div>
                        <label for="encode-output" class="block text-sm font-medium text-gray-700 mb-2">Base64 Output</label>
                        <textarea id="encode-output" rows="5" readonly class="w-full p-3 border bg-gray-50 border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                    <button id="encode-copy-btn" class="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-md hover:bg-gray-700 transition shadow-md">Copy to Clipboard</button>
                </div>
                
                <!-- Decode Tab -->
                <div id="decode" class="tab-content space-y-6">
                     <h2 class="font-bold text-lg text-gray-700">Decode from Base64</h2>
                    <div>
                         <label for="decode-input" class="block text-sm font-medium text-gray-700 mb-2">Base64 to Decode</label>
                        <textarea id="decode-input" rows="5" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" placeholder="Paste your Base64 string here..."></textarea>
                    </div>
                    <div>
                        <label for="decode-type" class="block text-sm font-medium text-gray-700 mb-2">Choose Output Type</label>
                        <select id="decode-type" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 transition shadow-sm">
                            <option value="text">Text / ASCII</option>
                            <option value="hex">Hexadecimal</option>
                            <option value="image">Image (auto-detect)</option>
                            <option value="pdf">PDF</option>
                            <option value="audio">Audio</option>
                            <option value="video">Video</option>
                            <option value="file">Generic File</option>
                        </select>
                    </div>
                     <div class="flex items-center">
                        <input id="decode-url-safe" type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                        <label for="decode-url-safe" class="ml-2 block text-sm text-gray-900">
                            Input is Base64URL format (URL and Filename safe)
                        </label>
                    </div>
                     <!-- Decoder Outputs -->
                    <div id="decode-text-output-container" class="input-container active">
                        <label for="decode-text-output" class="block text-sm font-medium text-gray-700 mb-2">Decoded Output</label>
                        <textarea id="decode-text-output" rows="5" readonly class="w-full p-3 border bg-gray-50 border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                    <div id="decode-file-output-container" class="input-container">
                        <label for="decode-filename" class="block text-sm font-medium text-gray-700 mb-2">Download Filename</label>
                        <input type="text" id="decode-filename" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" value="decoded-file.txt">
                    </div>
                    <button id="decode-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition shadow-md">Decode</button>
                </div>

                <!-- Image Format Converter -->
                <div id="image-converter" class="tab-content space-y-6">
                    <h2 class="font-bold text-lg text-gray-700">Image Format Converter</h2>
                    <div>
                        <label for="image-converter-input" class="block text-sm font-medium text-gray-700 mb-2">Upload Image (JPG, PNG, WebP)</label>
                        <input type="file" id="image-converter-input" accept="image/jpeg,image/png,image/webp" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="image-converter-format" class="block text-sm font-medium text-gray-700 mb-2">Convert To</label>
                            <select id="image-converter-format" class="w-full p-3 border border-gray-300 rounded-md shadow-sm">
                                <option value="png">PNG</option>
                                <option value="jpeg">JPEG</option>
                                <option value="webp">WebP</option>
                            </select>
                        </div>
                        <div id="jpeg-quality-container" class="hidden">
                            <label for="jpeg-quality" class="block text-sm font-medium text-gray-700 mb-2">JPEG Quality: <span id="jpeg-quality-value">0.92</span></label>
                            <input type="range" id="jpeg-quality" min="0.1" max="1" step="0.01" value="0.92" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>
                    <button id="image-converter-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition-transform transform hover:scale-105 shadow-md">Convert & Download Image</button>
                    <div id="image-converter-preview-container" class="hidden grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                        <div>
                            <h3 class="font-semibold mb-2">Original</h3>
                            <img id="image-converter-original-preview" class="max-w-full h-auto mx-auto rounded-md border bg-gray-50 p-1 shadow-sm" alt="Original Preview">
                        </div>
                        <div>
                            <h3 class="font-semibold mb-2">Converted</h3>
                             <img id="image-converter-converted-preview" class="max-w-full h-auto mx-auto rounded-md border bg-gray-50 p-1 shadow-sm" alt="Converted Preview">
                        </div>
                    </div>
                </div>

                <!-- Image Minifier Tab -->
                <div id="image-minifier" class="tab-content space-y-6">
                    <h2 class="font-bold text-lg text-gray-700">Image Minifier & Resizer</h2>
                    <div>
                        <label for="minifier-input" class="block text-sm font-medium text-gray-700 mb-2">Upload Image (JPG, PNG, WebP)</label>
                        <input type="file" id="minifier-input" accept="image/jpeg,image/png,image/webp" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <!-- Minifier Controls -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 border rounded-lg">
                        <div>
                            <label for="minifier-scale" class="block text-sm font-medium text-gray-700 mb-2">Resize by Percentage: <span id="minifier-scale-value">100</span>%</label>
                            <input type="range" id="minifier-scale" min="1" max="100" step="1" value="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center gap-2">
                                <label for="minifier-width" class="text-sm font-medium text-gray-700">W:</label>
                                <input type="number" id="minifier-width" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="Width">
                                <label for="minifier-height" class="text-sm font-medium text-gray-700">H:</label>
                                <input type="number" id="minifier-height" class="w-full p-2 border border-gray-300 rounded-md shadow-sm" placeholder="Height">
                            </div>
                            <div class="flex items-center">
                                <input id="minifier-aspect-ratio" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded" checked>
                                <label for="minifier-aspect-ratio" class="ml-2 block text-sm text-gray-900">Maintain aspect ratio</label>
                            </div>
                        </div>
                    </div>
                     <button id="minifier-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition-transform transform hover:scale-105 shadow-md">Minify & Download Image</button>
                    <!-- Minifier Previews -->
                    <div id="minifier-preview-container" class="hidden grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                        <div>
                            <h3 class="font-semibold mb-2">Original</h3>
                            <img id="minifier-original-preview" class="max-w-full h-auto mx-auto rounded-md border bg-gray-50 p-1 shadow-sm" alt="Original Preview">
                            <p id="minifier-original-size" class="text-sm text-gray-500 mt-2"></p>
                        </div>
                        <div>
                            <h3 class="font-semibold mb-2">Minified</h3>
                             <img id="minifier-minified-preview" class="max-w-full h-auto mx-auto rounded-md border bg-gray-50 p-1 shadow-sm" alt="Minified Preview">
                             <p id="minifier-minified-size" class="text-sm text-gray-500 mt-2"></p>
                        </div>
                    </div>
                </div>

                <!-- Document Converter Tab -->
                <div id="doc-converter" class="tab-content space-y-8">
                    <!-- HTML to DOCX -->
                    <div class="space-y-4 p-4 border rounded-lg bg-gray-50">
                        <h3 class="font-bold text-lg text-gray-700">HTML to DOCX</h3>
                        <div>
                            <label for="html-to-docx-input" class="block text-sm font-medium text-gray-700 mb-2">HTML Content</label>
                            <textarea id="html-to-docx-input" rows="8" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" placeholder="<h1>Hello</h1><p>This is a test.</p>"></textarea>
                        </div>
                        <div>
                            <label for="html-to-docx-filename" class="block text-sm font-medium text-gray-700 mb-2">Filename</label>
                            <input type="text" id="html-to-docx-filename" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" value="document.docx">
                        </div>
                        <button id="html-to-docx-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition shadow-md">Convert & Download DOCX</button>
                    </div>
                    <!-- DOCX to HTML -->
                    <div class="space-y-4 p-4 border rounded-lg bg-gray-50">
                        <h3 class="font-bold text-lg text-gray-700">DOCX to HTML</h3>
                        <div>
                            <label for="docx-to-html-input" class="block text-sm font-medium text-gray-700 mb-2">Upload .docx File</label>
                            <input type="file" id="docx-to-html-input" accept=".docx" class="w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="docx-to-html-output" class="block text-sm font-medium text-gray-700 mb-2">HTML Output</label>
                            <div id="docx-to-html-output" class="w-full p-3 border bg-white h-64 overflow-y-auto rounded-md shadow-sm"></div>
                        </div>
                        <button id="docx-copy-btn" class="w-full bg-gray-600 text-white font-bold py-3 px-4 rounded-md hover:bg-gray-700 transition shadow-md">Copy HTML</button>
                    </div>
                </div>

                <!-- HTML to PDF Converter Tab -->
                <div id="html-to-pdf" class="tab-content space-y-6">
                    <h2 class="font-bold text-lg text-gray-700">HTML to PDF Converter</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Input Side -->
                        <div class="space-y-4">
                            <div>
                                <label for="html-to-pdf-input" class="block text-sm font-medium text-gray-700 mb-2">HTML Content</label>
                                <textarea id="html-to-pdf-input" rows="10" class="w-full p-3 border border-gray-300 rounded-md shadow-sm font-mono text-sm" placeholder="<html>...</html>"><h1>My Document</h1><p>This is a paragraph with some <strong>bold text</strong> and <em>italic text</em>.</p><ul><li>List item 1</li><li>List item 2</li></ul></textarea>
                            </div>
                            <div>
                                <label for="html-to-pdf-filename" class="block text-sm font-medium text-gray-700 mb-2">PDF Filename</label>
                                <input type="text" id="html-to-pdf-filename" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" value="converted.pdf">
                            </div>
                            <button id="html-to-pdf-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-md hover:bg-indigo-700 transition shadow-md flex items-center justify-center">
                                <svg id="pdf-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                Convert & Download PDF
                            </button>
                        </div>
                        <!-- Preview Side -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Live Preview</label>
                            <iframe id="html-preview" class="w-full h-96 border border-gray-300 rounded-md shadow-sm bg-white"></iframe>
                        </div>
                    </div>
                </div>

                <!-- Unit Converter Tab -->
                <div id="unit-converter" class="tab-content space-y-6">
                    <h2 class="font-bold text-lg text-gray-700">Unit Converter</h2>
                    <div>
                        <label for="unit-type" class="block text-sm font-medium text-gray-700 mb-2">Conversion Type</label>
                        <select id="unit-type" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 transition shadow-sm">
                            <option value="length">Length</option>
                            <option value="mass">Weight / Mass</option>
                            <option value="temperature">Temperature</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-end">
                        <div>
                            <label for="unit-input-from" class="block text-sm font-medium text-gray-700 mb-2">From</label>
                            <input type="number" id="unit-input-from" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" value="1">
                        </div>
                        <div>
                            <select id="unit-select-from" class="w-full p-3 border border-gray-300 rounded-md shadow-sm"></select>
                        </div>
                         <div>
                            <label for="unit-input-to" class="block text-sm font-medium text-gray-700 mb-2">To</label>
                            <input type="number" id="unit-input-to" class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-gray-50" readonly>
                        </div>
                        <div>
                            <select id="unit-select-to" class="w-full p-3 border border-gray-300 rounded-md shadow-sm"></select>
                        </div>
                    </div>
                </div>

                <!-- Currency Converter Tab -->
                <div id="currency-converter" class="tab-content space-y-6">
                    <h2 class="font-bold text-lg text-gray-700">Currency Converter</h2>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-end">
                        <div>
                            <label for="currency-input-from" class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                            <input type="number" id="currency-input-from" class="w-full p-3 border border-gray-300 rounded-md shadow-sm" value="100">
                        </div>
                        <div>
                            <select id="currency-select-from" class="w-full p-3 border border-gray-300 rounded-md shadow-sm"></select>
                        </div>
                         <div>
                            <label for="currency-input-to" class="block text-sm font-medium text-gray-700 mb-2">Converted Amount</label>
                            <input type="number" id="currency-input-to" class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-gray-50" readonly>
                        </div>
                        <div>
                            <select id="currency-select-to" class="w-full p-3 border border-gray-300 rounded-md shadow-sm"></select>
                        </div>
                    </div>
                    <div id="currency-rate-info" class="text-center text-sm text-gray-500 h-5"></div>
                </div>

                <!-- Global Message Box -->
                <div id="messageBox" class="mt-6 text-center text-sm font-medium h-5"></div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="text-center mt-6 text-gray-400 text-xs">
            <p>&copy; 2025 All-in-One Converter. All Rights Reserved.</p>
        </footer>
    </div>

    <!-- Sidebar Toggle Button with Magic Dust Effect -->
    <div class="fixed top-1/2 -translate-y-1/2 right-0 z-20 group">
        <button id="sidebar-toggle" class="relative bg-indigo-600 text-white p-3 rounded-l-full shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">
            <div class="relative h-6 w-6">
                <!-- Hamburger Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h7" />
                </svg>
                <!-- Magic Wand Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute -top-2 -right-3 text-yellow-300 animate-sparkle animate-glow origin-bottom-right" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9.25,2.5C9.66,2.5 10,2.84 10,3.25V5.11L11.89,6.11C12.3,6.34 12.5,6.81 12.28,7.22L10.39,10.39L13.61,13.61L16.78,11.72C17.19,11.5 17.66,11.7 17.89,12.11L18.89,13.89V16.75C18.89,17.16 18.55,17.5 18.14,17.5C17.74,17.5 17.39,17.16 17.39,16.75V15.39L16.39,14.61L13.17,17.83L14.61,18.61L15.39,17.39H16.75C17.16,17.39 17.5,17.74 17.5,18.14C17.5,18.55 17.16,18.89 16.75,18.89H13.89L12.11,17.89C11.7,17.66 11.5,17.19 11.72,16.78L13.61,13.61L10.39,10.39L7.22,12.28C6.81,12.5 6.34,12.3 6.11,11.89L5.11,10.11V6.75C5.11,6.34 5.45,6 5.86,6C6.26,6 6.61,6.34 6.61,6.75V8.61L7.61,9.39L10.83,6.17L9.39,5.39L8.61,6.61V3.25C8.61,2.84 8.95,2.5 9.25,2.5M3.5,6.5C3.5,7.05 3.95,7.5 4.5,7.5C5.05,7.5 5.5,7.05 5.5,6.5C5.5,5.95 5.05,5.5 4.5,5.5C3.95,5.5 3.5,5.95 3.5,6.5M2,12C2,12.55 2.45,13 3,13C3.55,13 4,12.55 4,12C4,11.45 3.55,11 3,11C2.45,11 2,11.45 2,12M5.5,17.5C5.5,18.05 5.05,18.5 4.5,18.5C3.95,18.5 3.5,18.05 3.5,17.5C3.5,16.95 3.95,16.5 4.5,16.5C5.05,16.5 5.5,16.95 5.5,17.5M16.5,5.5C16.5,4.95 16.95,4.5 17.5,4.5C18.05,4.5 18.5,4.95 18.5,5.5C18.5,6.05 18.05,6.5 17.5,6.5C16.95,6.5 16.5,6.05 16.5,5.5M20,11C19.45,11 19,11.45 19,12C19,12.55 19.45,13 20,13C20.55,13 21,12.55 21,12C21,11.45 20.55,11 20,11M18.5,16.5C18.5,16.95 18.05,17.5 17.5,17.5C16.95,17.5 16.5,16.95 16.5,16.5C16.5,15.95 16.95,15.5 17.5,15.5C18.05,15.5 18.5,15.95 18.5,16.5Z" />
                </svg>
            </div>
        </button>
        <!-- Magic Dust Particles -->
        <div class="absolute top-1/2 left-1/2 w-full h-full pointer-events-none">
            <div class="sparkle-dust" style="--x:-20px; --y:-30px; animation-delay: 0s;"></div>
            <div class="sparkle-dust" style="--x:15px; --y:-25px; animation-delay: 0.2s;"></div>
            <div class="sparkle-dust" style="--x:25px; --y:10px; animation-delay: 0.4s;"></div>
            <div class="sparkle-dust" style="--x:-5px; --y:25px; animation-delay: 0.6s;"></div>
            <div class="sparkle-dust" style="--x:-25px; --y:-5px; animation-delay: 0.8s;"></div>
            <div class="sparkle-dust" style="--x:5px; --y:-20px; animation-delay: 1s;"></div>
        </div>
        <!-- Sidebar Awareness Popup -->
        <div id="sidebar-popup" class="absolute top-1/2 -translate-y-1/2 right-full mr-3 w-max bg-indigo-600 text-white text-sm font-semibold px-4 py-2 rounded-lg shadow-lg popup-hidden">
            Psst! Check out the extra tools!
            <div class="absolute top-1/2 -translate-y-1/2 -right-2 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-l-8 border-l-indigo-600"></div>
        </div>
    </div>


    <!-- Sidebar -->
    <div id="sidebar" class="fixed top-0 right-0 h-full w-full max-w-sm bg-white shadow-xl z-40 transform translate-x-full transition-transform duration-300 ease-in-out">
        <!-- Sidebar Header -->
        <div class="p-4 flex justify-between items-center border-b bg-gray-50">
            <h3 class="text-lg font-bold text-gray-800">Text Analyzer</h3>
            <button id="sidebar-close" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
        </div>
        <!-- Sidebar Content -->
        <div class="p-4 space-y-4">
            <label for="text-counter-input" class="block text-sm font-medium text-gray-700">Enter your text below:</label>
            <textarea id="text-counter-input" rows="8" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500 transition"></textarea>
            <!-- Stats Display -->
            <div id="text-stats" class="grid grid-cols-2 gap-3 text-sm text-gray-700">
                <div class="bg-gray-100 p-3 rounded-md">Words: <span id="word-count" class="font-bold text-gray-900 block text-lg">0</span></div>
                <div class="bg-gray-100 p-3 rounded-md">Characters: <span id="char-count" class="font-bold text-gray-900 block text-lg">0</span></div>
                <div class="bg-gray-100 p-3 rounded-md">Sentences: <span id="sentence-count" class="font-bold text-gray-900 block text-lg">0</span></div>
                <div class="bg-gray-100 p-3 rounded-md">Paragraphs: <span id="paragraph-count" class="font-bold text-gray-900 block text-lg">0</span></div>
            </div>
        </div>
    </div>
    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>


    <script>
        // --- Global Utils ---
        const messageBox = document.getElementById('messageBox');
        const showMessage = (message, color) => {
            messageBox.textContent = message;
            messageBox.className = `mt-6 text-center text-sm font-medium h-5 text-${color}-600`;
            setTimeout(() => { messageBox.textContent = ''; }, 5000);
        };
        const copyToClipboard = (textarea, button) => {
            if (!textarea.value) { showMessage('Nothing to copy.', 'red'); return; }
            textarea.select(); document.execCommand('copy');
            const originalText = button.textContent; button.textContent = 'Copied!';
            setTimeout(() => { button.textContent = originalText; }, 2000);
        };
        const formatBytes = (bytes, decimals = 2) => {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        };

        // --- Tab Switching ---
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active', 'bg-indigo-600', 'text-white'));
                button.classList.add('active', 'bg-indigo-600', 'text-white');
                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });
        
        // --- Encoder Logic ---
        const encodeType = document.getElementById('encode-type');
        const encodeBtn = document.getElementById('encode-btn');
        const encodeOutput = document.getElementById('encode-output');
        const encodeCopyBtn = document.getElementById('encode-copy-btn');
        const encodeUrlSafeCheckbox = document.getElementById('encode-url-safe');
        const encodeInputs = {
            text: document.getElementById('encode-text-input'),
            hex: document.getElementById('encode-hex-input'),
            file: document.getElementById('encode-file-input')
        };
        const fileValue = document.getElementById('encode-file-value');
        encodeType.addEventListener('change', () => {
            Object.values(encodeInputs).forEach(input => input.classList.remove('active'));
            const type = encodeType.value;
            if (['image', 'pdf', 'audio', 'video', 'file'].includes(type)) {
                encodeInputs.file.classList.add('active');
                const acceptMap = { image: 'image/*', pdf: 'application/pdf', audio: 'audio/*', video: 'video/*', file: '*' };
                fileValue.accept = acceptMap[type];
            } else {
                encodeInputs[type].classList.add('active');
            }
        });
        encodeCopyBtn.addEventListener('click', () => copyToClipboard(encodeOutput, encodeCopyBtn));
        encodeBtn.addEventListener('click', () => {
            const type = encodeType.value;
            const useUrlSafe = encodeUrlSafeCheckbox.checked;
            encodeOutput.value = '';
            const processAndSetOutput = (base64) => {
                if (useUrlSafe) {
                    encodeOutput.value = base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
                } else {
                    encodeOutput.value = base64;
                }
            };
            try {
                if (type === 'text') {
                    const text = document.getElementById('encode-text-value').value;
                    const utf8Bytes = new TextEncoder().encode(text);
                    let binary = '';
                    utf8Bytes.forEach(byte => binary += String.fromCharCode(byte));
                    processAndSetOutput(btoa(binary));
                } else if (type === 'hex') {
                    const hex = document.getElementById('encode-hex-value').value.replace(/\s/g, '');
                    if (hex.length % 2 !== 0) throw new Error("Invalid hex string.");
                    let binary = '';
                    for (let i = 0; i < hex.length; i += 2) {
                        binary += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
                    }
                    processAndSetOutput(btoa(binary));
                } else { // File types
                    const file = fileValue.files[0];
                    if (!file) { showMessage('Please select a file to encode.', 'red'); return; }
                    const reader = new FileReader();
                    reader.onload = e => { 
                        const base64 = e.target.result.split(',')[1];
                        processAndSetOutput(base64);
                        showMessage('File encoded successfully!', 'green');
                    };
                    reader.readAsDataURL(file);
                    return; 
                }
                showMessage('Encoded successfully!', 'green');
            } catch (e) {
                showMessage(`Error: ${e.message}`, 'red');
            }
        });
        
        // --- Decoder Logic ---
        const decodeType = document.getElementById('decode-type');
        const decodeBtn = document.getElementById('decode-btn');
        const decodeInput = document.getElementById('decode-input');
        const decodeUrlSafeCheckbox = document.getElementById('decode-url-safe');
        const decodeTextOutputContainer = document.getElementById('decode-text-output-container');
        const decodeFileOutputContainer = document.getElementById('decode-file-output-container');
        decodeType.addEventListener('change', () => {
            const isFile = !['text', 'hex'].includes(decodeType.value);
            decodeTextOutputContainer.classList.toggle('active', !isFile);
            decodeFileOutputContainer.classList.toggle('active', isFile);
        });
        decodeBtn.addEventListener('click', () => {
            let base64 = decodeInput.value.trim();
            if (!base64) { showMessage('Please enter a Base64 string to decode.', 'red'); return; }
            
            const isUrlSafe = decodeUrlSafeCheckbox.checked;
            if (isUrlSafe) {
                base64 = base64.replace(/-/g, '+').replace(/_/g, '/');
                while (base64.length % 4) { base64 += '='; }
            }
            const type = decodeType.value;
            try {
                const binary = atob(base64);
                if (type === 'text') {
                    const bytes = new Uint8Array(binary.length);
                    for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
                    document.getElementById('decode-text-output').value = new TextDecoder().decode(bytes);
                    showMessage('Decoded to text successfully!', 'green');
                } else if (type === 'hex') {
                    let hex = '';
                    for (let i = 0; i < binary.length; i++) {
                        hex += ('0' + binary.charCodeAt(i).toString(16)).slice(-2);
                    }
                    document.getElementById('decode-text-output').value = hex;
                    showMessage('Decoded to hex successfully!', 'green');
                } else { // File types
                    const len = binary.length;
                    const bytes = new Uint8Array(len);
                    for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);
                    const mimeMap = { pdf: 'application/pdf', image: 'image/png', audio: 'audio/mpeg', video: 'video/mp4', file: 'application/octet-stream' };
                    const blob = new Blob([bytes], { type: mimeMap[type] });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = document.getElementById('decode-filename').value || 'decoded-file';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                    showMessage(`Downloading ${link.download}...`, 'green');
                }
            } catch (e) {
                showMessage(`Error: Invalid Base64 string or format. ${e.message}`, 'red');
            }
        });


        // --- Image Format Converter Logic ---
        const imageConverterInput = document.getElementById('image-converter-input');
        const imageConverterFormat = document.getElementById('image-converter-format');
        const jpegQualityContainer = document.getElementById('jpeg-quality-container');
        const jpegQualitySlider = document.getElementById('jpeg-quality');
        const jpegQualityValue = document.getElementById('jpeg-quality-value');
        const imageConverterBtn = document.getElementById('image-converter-btn');
        const imageConverterPreviewContainer = document.getElementById('image-converter-preview-container');
        const originalPreview = document.getElementById('image-converter-original-preview');
        const convertedPreview = document.getElementById('image-converter-converted-preview');
        let originalConverterFile = null; let originalConverterFileName = '';
        imageConverterFormat.addEventListener('change', () => jpegQualityContainer.classList.toggle('hidden', imageConverterFormat.value !== 'jpeg'));
        jpegQualitySlider.addEventListener('input', () => jpegQualityValue.textContent = jpegQualitySlider.value);
        imageConverterInput.addEventListener('change', (e) => {
            originalConverterFile = e.target.files[0];
            if (!originalConverterFile) return;
            originalConverterFileName = originalConverterFile.name.split('.').slice(0, -1).join('.');
            const reader = new FileReader();
            reader.onload = (event) => {
                originalPreview.src = event.target.result;
                imageConverterPreviewContainer.classList.remove('hidden');
                imageConverterPreviewContainer.classList.add('grid');
                convertedPreview.src = "https://placehold.co/600x400/f3f4f6/9ca3af?text=Converted+Image";
            };
            reader.readAsDataURL(originalConverterFile);
        });
        imageConverterBtn.addEventListener('click', () => {
            if (!originalConverterFile) { showMessage('Please upload an image first.', 'red'); return; }
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width; canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    const format = imageConverterFormat.value;
                    const dataUrl = canvas.toDataURL(`image/${format}`, format === 'jpeg' ? parseFloat(jpegQualitySlider.value) : undefined);
                    convertedPreview.src = dataUrl;
                    const link = document.createElement('a');
                    link.href = dataUrl;
                    link.download = `${originalConverterFileName}.${format}`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    showMessage(`Successfully converted and downloaded ${link.download}`, 'green');
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(originalConverterFile);
        });

        // --- Image Minifier Logic ---
        const minifierInput = document.getElementById('minifier-input');
        const minifierScale = document.getElementById('minifier-scale');
        const minifierScaleValue = document.getElementById('minifier-scale-value');
        const minifierWidth = document.getElementById('minifier-width');
        const minifierHeight = document.getElementById('minifier-height');
        const minifierAspectRatio = document.getElementById('minifier-aspect-ratio');
        const minifierBtn = document.getElementById('minifier-btn');
        const minifierPreviewContainer = document.getElementById('minifier-preview-container');
        const minifierOriginalPreview = document.getElementById('minifier-original-preview');
        const minifierMinifiedPreview = document.getElementById('minifier-minified-preview');
        const minifierOriginalSize = document.getElementById('minifier-original-size');
        const minifierMinifiedSize = document.getElementById('minifier-minified-size');
        
        let originalMinifierFile = null;
        let originalMinifierWidth = 0;
        let originalMinifierHeight = 0;

        minifierInput.addEventListener('change', (e) => {
            originalMinifierFile = e.target.files[0];
            if (!originalMinifierFile) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    originalMinifierWidth = img.width;
                    originalMinifierHeight = img.height;
                    minifierWidth.value = originalMinifierWidth;
                    minifierHeight.value = originalMinifierHeight;
                    minifierScale.value = 100;
                    minifierScaleValue.textContent = 100;
                };
                img.src = event.target.result;

                minifierOriginalPreview.src = event.target.result;
                minifierOriginalSize.textContent = `Size: ${formatBytes(originalMinifierFile.size)}`;
                minifierPreviewContainer.classList.remove('hidden');
                minifierPreviewContainer.classList.add('grid');
                minifierMinifiedPreview.src = "https://placehold.co/600x400/f3f4f6/9ca3af?text=Minified+Image";
                minifierMinifiedSize.textContent = '';
            };
            reader.readAsDataURL(originalMinifierFile);
        });

        minifierScale.addEventListener('input', (e) => {
            const scale = e.target.value / 100;
            minifierScaleValue.textContent = e.target.value;
            if (originalMinifierWidth) {
                minifierWidth.value = Math.round(originalMinifierWidth * scale);
                minifierHeight.value = Math.round(originalMinifierHeight * scale);
            }
        });

        minifierWidth.addEventListener('input', () => {
             if (minifierAspectRatio.checked && originalMinifierWidth) {
                const ratio = originalMinifierHeight / originalMinifierWidth;
                minifierHeight.value = Math.round(minifierWidth.value * ratio);
             }
        });

        minifierHeight.addEventListener('input', () => {
             if (minifierAspectRatio.checked && originalMinifierHeight) {
                const ratio = originalMinifierWidth / originalMinifierHeight;
                minifierWidth.value = Math.round(minifierHeight.value * ratio);
             }
        });

        minifierBtn.addEventListener('click', () => {
            if (!originalMinifierFile) {
                showMessage('Please upload an image to minify.', 'red');
                return;
            }
            
            const targetWidth = parseInt(minifierWidth.value);
            const targetHeight = parseInt(minifierHeight.value);
            if (!targetWidth || !targetHeight || targetWidth <= 0 || targetHeight <= 0) {
                 showMessage('Please enter valid dimensions for resizing.', 'red');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = targetWidth;
                    canvas.height = targetHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, targetWidth, targetHeight);
                    
                    const mimeType = originalMinifierFile.type;
                    const quality = (mimeType === 'image/jpeg') ? 0.92 : 1.0;
                    
                    canvas.toBlob(blob => {
                        const dataUrl = URL.createObjectURL(blob);
                        minifierMinifiedPreview.src = dataUrl;
                        minifierMinifiedSize.textContent = `Size: ${formatBytes(blob.size)} (${(((originalMinifierFile.size - blob.size) / originalMinifierFile.size) * 100).toFixed(1)}% smaller)`;

                        const link = document.createElement('a');
                        link.href = dataUrl;
                        const nameParts = originalMinifierFile.name.split('.');
                        const extension = nameParts.pop();
                        link.download = `${nameParts.join('.')}-minified.${extension}`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        showMessage(`Successfully minified and downloaded image!`, 'green');

                    }, mimeType, quality);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(originalMinifierFile);
        });

        // --- Sidebar Logic ---
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const textCounterInput = document.getElementById('text-counter-input');
        const sidebarPopup = document.getElementById('sidebar-popup');

        const openSidebar = () => {
            sidebar.classList.remove('translate-x-full');
            sidebarOverlay.classList.remove('hidden');
            // Hide popup permanently once the sidebar is opened
            sidebarPopup.style.display = 'none';
            sessionStorage.setItem('sidebarPopupShown', 'true');
        };

        const closeSidebar = () => {
            sidebar.classList.add('translate-x-full');
            sidebarOverlay.classList.add('hidden');
        };

        sidebarToggle.addEventListener('click', openSidebar);
        sidebarClose.addEventListener('click', closeSidebar);
        sidebarOverlay.addEventListener('click', closeSidebar);

        // --- Text Analyzer Logic ---
        textCounterInput.addEventListener('input', () => {
            const text = textCounterInput.value;
            
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const characters = text.length;
            const sentences = (text.match(/[\w|)][.?!](\s|$)/g) || []).length;
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim() !== '').length;

            document.getElementById('word-count').textContent = words;
            document.getElementById('char-count').textContent = characters;
            document.getElementById('sentence-count').textContent = sentences;
            document.getElementById('paragraph-count').textContent = paragraphs;
        });

        // --- Sidebar Popup Logic ---
        if (!sessionStorage.getItem('sidebarPopupShown')) {
            // Show popup after 2.5 seconds
            setTimeout(() => {
                sidebarPopup.classList.remove('popup-hidden');
                sidebarPopup.classList.add('animate-popup-intro');

                // Hide popup after another 6 seconds
                setTimeout(() => {
                    sidebarPopup.style.opacity = '0';
                    sidebarPopup.style.transition = 'opacity 0.5s';
                    setTimeout(() => {
                       sidebarPopup.style.display = 'none';
                    }, 500);
                }, 6000);

            }, 2500);
        }

        // --- Document Converter Logic ---
        const htmlToDocxBtn = document.getElementById('html-to-docx-btn');
        const docxToHtmlInput = document.getElementById('docx-to-html-input');
        const docxToHtmlOutput = document.getElementById('docx-to-html-output');
        const docxCopyBtn = document.getElementById('docx-copy-btn');

        // HTML to DOCX
        htmlToDocxBtn.addEventListener('click', () => {
            const htmlContent = document.getElementById('html-to-docx-input').value;
            const fileName = document.getElementById('html-to-docx-filename').value || 'document.docx';

            if (!htmlContent.trim()) {
                showMessage('Please enter some HTML content.', 'red');
                return;
            }
            try {
                const converted = htmlDocx.asBlob(htmlContent);
                const link = document.createElement('a');
                link.href = URL.createObjectURL(converted);
                link.download = fileName.endsWith('.docx') ? fileName : `${fileName}.docx`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
                showMessage('DOCX file generated successfully!', 'green');
            } catch(e) {
                showMessage(`Error generating DOCX: ${e.message}`, 'red');
            }
        });

        // DOCX to HTML
        docxToHtmlInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            docxToHtmlOutput.innerHTML = '<p class="text-gray-500">Converting...</p>';

            const reader = new FileReader();
            reader.onload = (e) => {
                const arrayBuffer = e.target.result;
                mammoth.convertToHtml({ arrayBuffer: arrayBuffer })
                    .then(result => {
                        docxToHtmlOutput.innerHTML = result.value;
                        showMessage('DOCX converted to HTML successfully!', 'green');
                    })
                    .catch(err => {
                        docxToHtmlOutput.innerHTML = `<p class="text-red-500">Error converting file.</p>`;
                        showMessage(`Error: ${err.message}`, 'red');
                        console.error(err);
                    });
            };
            reader.readAsArrayBuffer(file);
        });

        // Copy DOCX's HTML output
        docxCopyBtn.addEventListener('click', () => {
            const htmlToCopy = docxToHtmlOutput.innerHTML;
            if (!htmlToCopy || htmlToCopy.includes('Converting...') || htmlToCopy.includes('Error')) {
                showMessage('Nothing to copy.', 'red');
                return;
            }
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = htmlToCopy;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);

            const originalText = docxCopyBtn.textContent;
            docxCopyBtn.textContent = 'Copied!';
            setTimeout(() => { docxCopyBtn.textContent = originalText; }, 2000);
        });

        // --- HTML to PDF Converter Logic ---
        const htmlToPdfInput = document.getElementById('html-to-pdf-input');
        const htmlPreview = document.getElementById('html-preview');
        const htmlToPdfBtn = document.getElementById('html-to-pdf-btn');
        const pdfSpinner = document.getElementById('pdf-spinner');

        const updatePreview = () => {
            htmlPreview.srcdoc = htmlToPdfInput.value;
        };
        htmlToPdfInput.addEventListener('input', updatePreview);
        
        htmlToPdfBtn.addEventListener('click', () => {
            const htmlContent = htmlToPdfInput.value;
            const fileName = document.getElementById('html-to-pdf-filename').value || 'converted.pdf';

            if (!htmlContent.trim()) {
                showMessage('Please enter some HTML content to convert.', 'red');
                return;
            }

            const { jsPDF } = window.jspdf;

            // Create a temporary, off-screen container for rendering to get accurate dimensions
            const renderContainer = document.createElement('div');
            renderContainer.style.position = 'absolute';
            renderContainer.style.left = '-9999px'; // Move it off-screen
            renderContainer.style.width = '210mm'; // Standard A4 width
            renderContainer.style.background = 'white';
            
            // Add a basic stylesheet to ensure default styles are applied for rendering
            const styledHtmlContent = `
                <style>
                    body { font-family: 'Inter', sans-serif; color: #111827; }
                    h1, h2, h3, h4, h5, h6, b, strong { font-weight: 700; }
                    h1 { font-size: 2em; } h2 { font-size: 1.5em; } h3 { font-size: 1.17em; }
                    p { margin: 1em 0; }
                    ul, ol { padding-left: 40px; }
                    i, em { font-style: italic; }
                </style>
                ${htmlContent}
            `;
            renderContainer.innerHTML = styledHtmlContent;
            document.body.appendChild(renderContainer);


            pdfSpinner.classList.remove('hidden');
            htmlToPdfBtn.disabled = true;
            htmlToPdfBtn.classList.add('opacity-75', 'cursor-not-allowed');
            showMessage('Generating PDF, please wait...', 'indigo');

            html2canvas(renderContainer, {
                scale: 2,
                useCORS: true,
                logging: false,
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const canvasWidth = canvas.width;
                const canvasHeight = canvas.height;
                const ratio = canvasWidth / canvasHeight;
                const imgWidth = pdfWidth - 20; // with margin
                const imgHeight = imgWidth / ratio;
                
                let heightLeft = imgHeight;
                let position = 10; // top margin

                pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                heightLeft -= (pdfHeight - 20);

                while (heightLeft > 0) {
                    position = - (imgHeight - heightLeft) + 10;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
                    heightLeft -= (pdfHeight - 20);
                }

                pdf.save(fileName.endsWith('.pdf') ? fileName : `${fileName}.pdf`);
                showMessage('PDF downloaded successfully!', 'green');

            }).catch(err => {
                showMessage(`Error generating PDF: ${err.message}`, 'red');
                console.error("PDF Generation Error:", err);
            }).finally(() => {
                document.body.removeChild(renderContainer); // Clean up the temporary container
                pdfSpinner.classList.add('hidden');
                htmlToPdfBtn.disabled = false;
                htmlToPdfBtn.classList.remove('opacity-75', 'cursor-not-allowed');
            });
        });

        // --- Unit Converter Logic ---
        const unitType = document.getElementById('unit-type');
        const unitInputFrom = document.getElementById('unit-input-from');
        const unitSelectFrom = document.getElementById('unit-select-from');
        const unitInputTo = document.getElementById('unit-input-to');
        const unitSelectTo = document.getElementById('unit-select-to');

        const units = {
            length: { name: 'Length', default: ['meters', 'kilometers'], data: { meters: { name: 'Meters', to_base: 1 }, kilometers: { name: 'Kilometers', to_base: 1000 }, miles: { name: 'Miles', to_base: 1609.34 }, feet: { name: 'Feet', to_base: 0.3048 }, inches: { name: 'Inches', to_base: 0.0254 } } },
            mass: { name: 'Mass', default: ['grams', 'kilograms'], data: { grams: { name: 'Grams', to_base: 1 }, kilograms: { name: 'Kilograms', to_base: 1000 }, pounds: { name: 'Pounds', to_base: 453.592 }, ounces: { name: 'Ounces', to_base: 28.3495 } } },
            temperature: { name: 'Temperature', default: ['celsius', 'fahrenheit'], data: { celsius: { name: 'Celsius' }, fahrenheit: { name: 'Fahrenheit' }, kelvin: { name: 'Kelvin' } } }
        };

        const populateUnitSelectors = () => {
            const selectedType = unitType.value;
            const unitData = units[selectedType].data;
            unitSelectFrom.innerHTML = '';
            unitSelectTo.innerHTML = '';
            for(const key in unitData) {
                const option1 = new Option(unitData[key].name, key);
                const option2 = new Option(unitData[key].name, key);
                unitSelectFrom.add(option1);
                unitSelectTo.add(option2);
            }
            unitSelectFrom.value = units[selectedType].default[0];
            unitSelectTo.value = units[selectedType].default[1];
            convertUnits();
        };

        const convertUnits = () => {
            const fromVal = parseFloat(unitInputFrom.value);
            if(isNaN(fromVal)) { unitInputTo.value = ''; return; }

            const fromUnit = unitSelectFrom.value;
            const toUnit = unitSelectTo.value;
            const type = unitType.value;
            let result;

            if (type === 'temperature') {
                let tempInC;
                if(fromUnit === 'celsius') tempInC = fromVal;
                else if(fromUnit === 'fahrenheit') tempInC = (fromVal - 32) * 5 / 9;
                else if(fromUnit === 'kelvin') tempInC = fromVal - 273.15;

                if(toUnit === 'celsius') result = tempInC;
                else if(toUnit === 'fahrenheit') result = (tempInC * 9 / 5) + 32;
                else if(toUnit === 'kelvin') result = tempInC + 273.15;
            } else {
                const fromFactor = units[type].data[fromUnit].to_base;
                const toFactor = units[type].data[toUnit].to_base;
                result = fromVal * fromFactor / toFactor;
            }

            unitInputTo.value = result.toFixed(5);
        };
        
        [unitType, unitInputFrom, unitSelectFrom, unitSelectTo].forEach(el => {
            el.addEventListener('change', convertUnits);
            el.addEventListener('input', convertUnits);
        });

        // --- Currency Converter Logic ---
        const currencyInputFrom = document.getElementById('currency-input-from');
        const currencySelectFrom = document.getElementById('currency-select-from');
        const currencyInputTo = document.getElementById('currency-input-to');
        const currencySelectTo = document.getElementById('currency-select-to');
        const currencyRateInfo = document.getElementById('currency-rate-info');
        let exchangeRates = {};

        const fetchRates = async () => {
            try {
                currencyRateInfo.textContent = 'Fetching latest rates...';
                const response = await fetch('https://open.er-api.com/v6/latest/USD');
                if(!response.ok) throw new Error('Network response was not ok.');
                const data = await response.json();
                exchangeRates = data.rates;
                const currencies = Object.keys(exchangeRates);
                currencySelectFrom.innerHTML = '';
                currencySelectTo.innerHTML = '';
                currencies.forEach(currency => {
                    currencySelectFrom.add(new Option(currency, currency));
                    currencySelectTo.add(new Option(currency, currency));
                });
                currencySelectFrom.value = 'USD';
                currencySelectTo.value = 'EUR';
                convertCurrency();
                const date = new Date(data.time_last_update_utc).toLocaleString();
                currencyRateInfo.textContent = `Rates updated: ${date}`;
            } catch(error) {
                currencyRateInfo.textContent = 'Could not fetch exchange rates.';
                showMessage('Failed to load currency data.', 'red');
            }
        };

        const convertCurrency = () => {
            const amount = parseFloat(currencyInputFrom.value);
            if(isNaN(amount) || !Object.keys(exchangeRates).length) {
                currencyInputTo.value = '';
                return;
            }
            const fromCurrency = currencySelectFrom.value;
            const toCurrency = currencySelectTo.value;
            const fromRate = exchangeRates[fromCurrency];
            const toRate = exchangeRates[toCurrency];
            const result = (amount / fromRate) * toRate;
            currencyInputTo.value = result.toFixed(2);

            const singleUnitRate = (1 / fromRate) * toRate;
            currencyRateInfo.textContent = `1 ${fromCurrency} = ${singleUnitRate.toFixed(4)} ${toCurrency}`;
        };

        [currencyInputFrom, currencySelectFrom, currencySelectTo].forEach(el => {
            el.addEventListener('change', convertCurrency);
            el.addEventListener('input', convertCurrency);
        });


        // Initialize default views and data
        document.querySelector('[data-tab="encode"]').click();
        encodeType.dispatchEvent(new Event('change'));
        decodeType.dispatchEvent(new Event('change'));
        updatePreview(); // Initial preview for PDF converter
        populateUnitSelectors(); // Initial population for Unit converter
        fetchRates(); // Fetch currency rates on load
    </script>
</body>
</html>

